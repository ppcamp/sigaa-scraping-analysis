<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <link rel="shortcut icon" href="../../../_static/favicon.ico"/><meta name="generator" content="sphinx-3.5.4, furo 2021.03.20.beta30"/>
        <title>modules.ahp.Ahp - Sigaa Análise 0.0.8 documentation</title>
      <link rel="stylesheet" href="../../../_static/styles/furo.css?digest=978e1795dfe158b585dda6a8417f6411828bf3ed">
    <link rel="stylesheet" href="../../../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../../../_static/css/index.css" />
    <link rel="stylesheet" href="../../../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">Sigaa Análise 0.0.8 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Sigaa Análise 0.0.8 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../help.html">Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../todo.html">ToDo</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">Brief</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../modules.html#sub-modules">Sub modules</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules.ahp.html">ahp package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules.grid.html">grid package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html#module-modules.Plot">Plot module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html#module-modules.Score">Score module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html#module-modules.Skillset">Skillset module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html#module-modules.util">util module</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <h1>Source code for modules.ahp.Ahp</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># type: ignore</span>

<span class="sd">"""</span>
<span class="sd">Module that contains some common functions to handle with ahp data.</span>
<span class="sd">It performs the ahp calculations.</span>

<span class="sd">Todo</span>
<span class="sd">----</span>
<span class="sd">Must implement:</span>

<span class="sd">- Test case for :class:`.Mapping` methods</span>
<span class="sd">- Loggers for :class:`.Mapping` methods</span>
<span class="sd">"""</span>

<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Final</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">no_type_check</span>
<span class="kn">import</span> <span class="nn">typing</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Inconsistency index (Random Index, RI) mapping.\</span>
<span class="c1"># The index is equivalent to matrix cols (n) -1</span>

<span class="c1"># JS_Index | cols |Random index  (calculated by Saaty)</span>
<span class="c1"># ---------|------|----------------------------------</span>
<span class="c1">#    0     |   1  | there's only one question. Therefore, you can't apply AHP</span>
<span class="c1">#    1     |   2  | there's only two questions. Therefore, you can't apply AHP, since that you just have two possible choices.</span>
<span class="c1">#    2^    |  3^  | there's at least three questions. Therefore, you use the value</span>
<span class="c1"># test</span>
<span class="n">__RI</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mf">0.58</span><span class="p">,</span>
    <span class="mf">0.9</span><span class="p">,</span>
    <span class="mf">1.12</span><span class="p">,</span>
    <span class="mf">1.24</span><span class="p">,</span>
    <span class="mf">1.32</span><span class="p">,</span>
    <span class="mf">1.41</span><span class="p">,</span>
    <span class="mf">1.45</span><span class="p">,</span>
    <span class="mf">1.49</span><span class="p">,</span>
    <span class="mf">1.51</span><span class="p">,</span>
    <span class="mf">1.48</span><span class="p">,</span>
    <span class="mf">1.56</span><span class="p">,</span>
    <span class="mf">1.57</span><span class="p">,</span>
    <span class="mf">1.59</span>
<span class="p">]</span>


<div class="viewcode-block" id="calculate"><a class="viewcode-back" href="../../../modules.ahp.html#modules.ahp.Ahp.calculate">[docs]</a><span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span> <span class="n">roundp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
    <span class="sd">"""</span>
<span class="sd">    Calculates AHP and returns the *IC* and *priority_vector*.</span>
<span class="sd">    To an AHP be valid, it must have its IC bellow than 0.1.</span>

<span class="sd">    Args</span>
<span class="sd">    ----</span>
<span class="sd">    `obj`:</span>
<span class="sd">        The matrix(NxN) that holds the ahp values</span>

<span class="sd">    Keyword Args</span>
<span class="sd">    ------------</span>
<span class="sd">    `roundp`:</span>
<span class="sd">        The number of decimal places used to round.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Tuple[float, List[float]]</span>
<span class="sd">        It returns a tuple/vector, where the first element is the IC calculated over ahp,\</span>
<span class="sd">            and the second one, is the proper index.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; from modules.ahp import Ahp</span>
<span class="sd">    &gt;&gt;&gt; # import this module</span>
<span class="sd">    &gt;&gt;&gt; from modules.ahp import Ahp</span>
<span class="sd">    &gt;&gt;&gt; # some input matrix</span>
<span class="sd">    &gt;&gt;&gt; matrix = [</span>
<span class="sd">    ...     [1, 1, 1],</span>
<span class="sd">    ...     [1, 1, 1],</span>
<span class="sd">    ...     [1, 1, 1],</span>
<span class="sd">    ... ]</span>
<span class="sd">    &gt;&gt;&gt; # calculate the index and its priority vector</span>
<span class="sd">    &gt;&gt;&gt; consistency_index, priority_vector = Ahp.calculate(matrix)</span>
<span class="sd">    &gt;&gt;&gt; # in this case, should not raise this</span>
<span class="sd">    &gt;&gt;&gt; assert consistency_index&gt;=0.1, "Inconsistent ahp matrix"</span>

<span class="sd">    Tip</span>
<span class="sd">    ---</span>
<span class="sd">    This method not change the current value of object. So we can use it later if not pass through test.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    `Analytic Hierarchy Process`_</span>

<span class="sd">    .. _Analytic Hierarchy Process:</span>
<span class="sd">        https://www.youtube.com/watch?v=J4T70o8gjlk&amp;ab_channel=ManojMathew</span>
<span class="sd">    """</span>
    <span class="c1"># The AHP work as follows:</span>
    <span class="c1"># 1) Developing a hierarchical structure with a goal at the top level, the attributes/criteria at</span>
    <span class="c1">#     the second level and the alternatives at the third level</span>
    <span class="c1"># 2) Determine the relative importance of different attributes or Criteria with respect to the goal</span>
    <span class="c1">#     Pairwise comparation matrix. Bellow follows the example of relative scaling:</span>
    <span class="c1">#             1           - Equal importance</span>
    <span class="c1">#             3           - Moderate importance</span>
    <span class="c1">#             5           - Strong importance</span>
    <span class="c1">#             7           - Very strong importance</span>
    <span class="c1">#             9           - Extreme importance</span>
    <span class="c1">#         2,4,5,8        - Intermediate values</span>
    <span class="c1">#     1/3, 1/5, 1/7, 1/9  - Are values for inverse comparison</span>
    <span class="c1"># 3) Calculate the consistency</span>

    <span class="c1"># Therefore, to this form:</span>
    <span class="c1"># 1) The Main objective is get the discrepance bettween answers, the alternatives are the questions</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Calculating AHP for </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">. Rounding by </span><span class="si">{</span><span class="n">roundp</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>

    <span class="c1"># the length of my matrix</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="c1"># If exist only 2 questions, ahp is not needed</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'Exists only 2 questions. AHP can</span><span class="se">\'</span><span class="s1">t be calculated'</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[]</span>

    <span class="c1"># If we don't pass matrix object, we'll ...</span>
    <span class="c1"># ... copy the matrix, doing so, we don't change the current value of matrix stored in "obj"</span>
    <span class="c1"># if matrix is None:</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">obj</span><span class="p">))</span>

    <span class="c1"># This is the Pair-wise comparasion matrix</span>

    <span class="c1"># :Description:</span>
    <span class="c1">#     Object that will be modified in ahp.</span>
    <span class="c1">#     At this point it will be the copy of `obj`, which is something like this:</span>

    <span class="c1"># Example</span>
    <span class="c1"># ---------</span>
    <span class="c1"># ________| Price | Storage | Camera | Looks</span>
    <span class="c1"># Price   |   1   |    5    |   4    | 7</span>
    <span class="c1"># Storage |  1/5  |    1    |   1/2  | 3</span>
    <span class="c1"># Camera  |  1/4  |    2    |   1    | 3</span>
    <span class="c1"># Looks   |  1/7  |   1/3   |  1/3   | 1</span>
    <span class="n">pair_wise_comp_matrix</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">obj</span><span class="p">))</span>

    <span class="c1"># Normalize the pair-wise matrix</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
        <span class="c1"># Sum each column</span>
        <span class="c1"># ________| Price | Storage | Camera | Looks</span>
        <span class="c1"># Price   |   1   |    5    |   4    | 7</span>
        <span class="c1"># Storage |  1/5  |    1    |   1/2  | 3</span>
        <span class="c1"># Camera  |  1/4  |    2    |   1    | 3</span>
        <span class="c1"># Looks   |  1/7  |   1/3   |  1/3   | 1</span>
        <span class="c1"># --------|-------|---------|--------|--------</span>
        <span class="c1"># Sum     |  1.59 |   8.33  |5.83    | 14</span>
        <span class="n">column_sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
            <span class="n">column_sum</span> <span class="o">+=</span> <span class="n">matrix</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>

        <span class="c1"># Normalize the copied table</span>

        <span class="c1"># ________|     Price    |   Storage   |    Camera    | Looks</span>
        <span class="c1"># Price   |   (1)/1.59   |  (5)/8.33   |   (4)/5.83   | (7)/14</span>
        <span class="c1"># Storage |  (1/5)/1.59  |  (1)/8.33   |  (1/2)/5.83  | (3)/14</span>
        <span class="c1"># Camera  |  (1/4)/1.59  |  (2)/8.33   |   (1)/5.83   | (3)/14</span>
        <span class="c1"># Looks   |  (1/7)/1.59  | (1/3)/8.33  |  (1/3)/5.83  | (1)/14</span>
        <span class="c1"># --------|--------------|-------------|--------------|--------</span>
        <span class="c1"># Sum     |     1.59     |    8.33     |     5.83     |   14</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
            <span class="n">pair_wise_comp_matrix</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">/=</span> <span class="n">column_sum</span>

    <span class="c1"># Priority vector (sum of row / row length). Also named as criteria weights</span>
    <span class="c1"># ________|     Price    |   Storage   |    Camera    | Looks  | SUM(row)/cols -&gt; criteria weights</span>
    <span class="c1"># Price   |    0.6289    |   0.6002    |    0.6891    |  0.500 | (</span>
    <span class="c1">#     0.6289+0.6002+0.6891+0.500)/4</span>
    <span class="c1"># Storage |  (1/5)/1.59  |  (1)/8.33   |  (1/2)/5.83  | (3)/14 |</span>
    <span class="c1"># Camera  |  (1/4)/1.59  |  (2)/8.33   |   (1)/5.83   | (3)/14 |</span>
    <span class="c1"># Looks   |  (1/7)/1.59  | (1/3)/8.33  |  (1/3)/5.83  | (1)/14 |</span>
    <span class="c1"># --------|--------------|-------------|--------------|--------|</span>
    <span class="c1"># Sum     |     1.59     |    8.33     |     5.83     |   14</span>
    <span class="n">priorityVec</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span><span class="o">*</span><span class="n">length</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
        <span class="n">priorityVec</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pair_wise_comp_matrix</span><span class="p">[</span><span class="n">row</span><span class="p">])</span><span class="o">/</span><span class="n">length</span>

    <span class="c1"># Apply the (priorityVec) into column values</span>

    <span class="c1"># Criteria|</span>
    <span class="c1">#  weights|    0.6038    |      0.1365     |    0.1957      | 0.0646</span>
    <span class="c1"># --------|--------------|-----------------|----------------|-----------</span>
    <span class="c1">#         |     Price    |     Storage     |     Camera     | Looks</span>
    <span class="c1"># Price   |   1 * 0.6038 |    5 * 0.1365   |   4 * 0.1957   | 7 * 0.0646</span>
    <span class="c1"># Storage |  1/5 * 0.6038|    1 * 0.1365   |   1/2 * 0.1957 | 3 * 0.0646</span>
    <span class="c1"># Camera  |  1/4 * 0.6038|    2 * 0.1365   |   1 * 0.1957   | 3 * 0.0646</span>
    <span class="c1"># Looks   |  1/7 * 0.6038|   1/3 * 0.1365  |  1/3 * 0.1957  | 1 * 0.0646</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
            <span class="n">matrix</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
                <span class="n">priorityVec</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">*</span> <span class="n">matrix</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">],</span> <span class="n">roundp</span><span class="p">)</span>

    <span class="c1"># Weight vector</span>

    <span class="c1"># Criteria|              |                 |                |           | Weigth</span>
    <span class="c1">#  weights|    0.6038    |      0.1365     |    0.1957      | 0.0646    | vector</span>
    <span class="c1"># --------|--------------|-----------------|----------------|-----------|--------</span>
    <span class="c1">#         |     Price    |     Storage     |     Camera     | Looks     | SUM(row)</span>
    <span class="c1"># Price   |   1 * 0.6038 |    5 * 0.1365   |   4 * 0.1957   | 7 * 0.0646| 0.6038 + 0.6825 + 0.7832 + 0.4522 = 2.517</span>
    <span class="c1"># Storage |  1/5 * 0.6038|    1 * 0.1365   |   1/2 * 0.1957 | 3 * 0.0646|</span>
    <span class="c1"># Camera  |  1/4 * 0.6038|    2 * 0.1365   |   1 * 0.1957   | 3 * 0.0646|</span>
    <span class="c1"># Looks   |  1/7 * 0.6038|   1/3 * 0.1365  |  1/3 * 0.1957  | 1 * 0.0646|</span>
    <span class="n">weightVec</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span><span class="o">*</span><span class="n">length</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
        <span class="n">weightVec</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">matrix</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>

    <span class="c1"># Check consistency</span>
    <span class="c1"># Criteria|              |                |            |           | Weigth  | Result</span>
    <span class="c1">#  weights|    0.6038    |      0.1365    |   0.1957   |  0.0646   | vector  |</span>
    <span class="c1"># --------|--------------|----------------|------------|-----------|---------|-------------</span>
    <span class="c1">#         |     Price    |    Storage     |   Camera   |   Looks   | SUM(row)| weightVec/priorityVec</span>
    <span class="c1"># Price   |    0.6038    |     0.6825     |   0.7832   |   0.4522  |  2.517  | 2.517/0.6038</span>
    <span class="c1"># Storage |    0.1208    |    0.1365      |   0.0979   |   0.1938  |  0.5490 | 0.5490/0.1365</span>
    <span class="c1"># Camera  |    0.1510    |    0.2730      |   0.1958   |   0.1938  |  0.8136 | 0.8136/0.1957</span>
    <span class="c1"># Looks   |    0.0863    |    0.0455      |   0.0653   |   0.0646  |  0.2616 | 0.2616/0.0646</span>
    <span class="c1"># --------|--------------|----------------|------------|-----------|---------|-------------</span>
    <span class="c1"># -&gt;  lambda_max =&gt;  [ (2.517/0.6038) + (0.5490/0.1365) + (0.8136/0.1957) + (0.2616/0.0646) ] / 4</span>
    <span class="c1"># -&gt;  CI =&gt; [lambda_max - n]/n - 1, where n is the number of cols</span>

    <span class="c1"># We must use a function because lambda doesn't suppor tuple anymore</span>

    <span class="k">def</span> <span class="nf">divide</span><span class="p">(</span><span class="n">icurr</span><span class="p">):</span>
        <span class="c1"># unpack</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">curr</span> <span class="o">=</span> <span class="n">icurr</span>
        <span class="k">return</span> <span class="n">curr</span><span class="o">/</span><span class="n">priorityVec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">lambda_max</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">divide</span><span class="p">,</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">weightVec</span><span class="p">))))</span> <span class="o">/</span> <span class="n">length</span>
    <span class="n">ci</span> <span class="o">=</span> <span class="p">(</span><span class="n">lambda_max</span> <span class="o">-</span> <span class="n">length</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Calculate the consistency ratio CR, which is given by the formula:\</span>
    <span class="c1"># CR = CI/RI, where RI is the random index calculated by Saaty</span>
    <span class="n">cr</span> <span class="o">=</span> <span class="n">ci</span> <span class="o">/</span> <span class="n">__RI</span><span class="p">[</span><span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># to compare, it must be less than 0.1 by Saaty</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">'AHP calculated. CI=</span><span class="si">{</span><span class="n">ci</span><span class="si">}</span><span class="s1">, CR=</span><span class="si">{</span><span class="n">cr</span><span class="si">}</span><span class="s1">, PRIORITY_VEC=</span><span class="si">{</span><span class="n">priorityVec</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cr</span><span class="p">,</span> <span class="n">priorityVec</span></div>


<div class="viewcode-block" id="get_q15_value"><a class="viewcode-back" href="../../../modules.ahp.html#modules.ahp.Ahp.get_q15_value">[docs]</a><span class="k">def</span> <span class="nf">get_q15_value</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">roundp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Get the equivalent value `v`, in percentual terms. (Normalized value)</span>

<span class="sd">    Args</span>
<span class="sd">    ----</span>
<span class="sd">    `v`:</span>
<span class="sd">        The number to be normalized</span>

<span class="sd">    Keyword Args</span>
<span class="sd">    -------------</span>
<span class="sd">    `roundp`:</span>
<span class="sd">        The number of decimal places to be rounded</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The equivalent number converted into a value in [0..~1]</span>

<span class="sd">    Caution</span>
<span class="sd">    -------</span>
<span class="sd">    This number should be in [1/9, 1/7, 1/5, 1/3, 1, 3, 5, 7, 9]</span>

<span class="sd">    It does the following operation:</span>

<span class="sd">    .. math::</span>

<span class="sd">        x(n) = \\frac{V(n) - 1/9}{9-1/9} \\\\</span>
<span class="sd">        \\therefore \\begin{cases} x(1/9) \\approx 0 \\\\ x(9) \\approx 1 \\end{cases}</span>
<span class="sd">    """</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Getting q15 value for </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">. Rounding by </span><span class="si">{</span><span class="n">roundp</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">((</span><span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">9</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">9</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">9</span><span class="p">),</span> <span class="n">roundp</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mapping"><a class="viewcode-back" href="../../../modules.ahp.html#modules.ahp.Ahp.Mapping">[docs]</a><span class="k">class</span> <span class="nc">Mapping</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    A class object used to encapsulate all the mapping methods.</span>
<span class="sd">    Usually used with values obtained of :meth:`.calculate`</span>
<span class="sd">    or :meth:`modules.grid.walk_through_graph`</span>
<span class="sd">    """</span>

    <span class="n">MATRICES_IDENTIFIERS</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">'root'</span><span class="p">,</span> <span class="s1">'q1'</span><span class="p">,</span> <span class="s1">'q12'</span><span class="p">,</span> <span class="s1">'q13'</span><span class="p">,</span> <span class="s1">'q2'</span><span class="p">,</span> <span class="s1">'q3'</span><span class="p">]</span>

    <span class="c1"># The section root there's no binding equivalent for student's</span>
    <span class="n">COMPETENCES_MATRIX_ROOT</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"Conhecimento técnico"</span><span class="p">,</span>
        <span class="s2">"Competências, habilidades e atributos pessoais e profissionais: gerenciar projetos, compreender problemas e autoaprendizado"</span><span class="p">,</span>
        <span class="s2">"Competências e habilidades interpessoais: trabalho em equipe e comunicação"</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># In sheets, there's no such fields</span>
    <span class="n">COMPETENCES_MATRIX_Q1</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"Matemática e física"</span><span class="p">,</span>
        <span class="c1"># "Conhecimento, métodos e ferramentas fundamentais de computação básica",</span>
        <span class="c1"># "Conhecimento, métodos e ferramentas na área de sistemas de software",</span>
        <span class="s2">"Sistemas microprocessados"</span><span class="p">,</span>
        <span class="c1"># "Conhecimentos básicos em sistemas de comunicação",</span>
        <span class="s2">"Conhecimento em sistemas de automação "</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># In sigaa's form there is these fields</span>
    <span class="n">COMPETENCES_MATRIX_FORM_Q1</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"Matemática e física"</span><span class="p">,</span>
        <span class="s2">"Conhecimento, métodos e ferramentas fundamentais de computação básica"</span><span class="p">,</span>
        <span class="s2">"Conhecimento, métodos e ferramentas na área de sistemas de software"</span><span class="p">,</span>
        <span class="s2">"Sistemas microprocessados"</span><span class="p">,</span>
        <span class="s2">"Conhecimentos básicos em sistemas de comunicação"</span><span class="p">,</span>
        <span class="s2">"Conhecimento em sistemas de automação "</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">COMPETENCES_MATRIX_Q12</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"Lógica, algoritmos, teoria da comp,  estruras de dados."</span><span class="p">,</span>
        <span class="s2">"Linguagens e paradigmas."</span><span class="p">,</span>
        <span class="s2">"PAA"</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">COMPETENCES_MATRIX_Q13</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"Configurar plataformas para softwares e serviços."</span><span class="p">,</span>
        <span class="s2">"Arquiteturas de computadores"</span><span class="p">,</span>
        <span class="s2">"Segurança de sis. de comp."</span><span class="p">,</span>
        <span class="s2">"Engenharia de software"</span><span class="p">,</span>
        <span class="s2">"Inteligência artificial"</span><span class="p">,</span>
        <span class="s2">"Desenvolvimento Web e Mobile"</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">COMPETENCES_MATRIX_Q15</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"Redes de computadores"</span><span class="p">,</span>
        <span class="s2">"Software para sistemas de comunicação"</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">COMPETENCES_MATRIX_Q2</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"Gerenciar projetos e sistemas de computação"</span><span class="p">,</span>
        <span class="s2">"Engenharia-econômica"</span><span class="p">,</span>
        <span class="s2">"Compreender e resolver problemas"</span><span class="p">,</span>
        <span class="s2">"Autoaprendizado"</span><span class="p">,</span>
        <span class="s2">"Criatividade e Inovação"</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">COMPETENCES_MATRIX_Q3</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"Comunicação oral e escrita"</span><span class="p">,</span>
        <span class="s2">"Língua inglesa"</span><span class="p">,</span>
        <span class="s2">"Empreender e exercer liderança"</span><span class="p">,</span>
        <span class="s2">"Trabalho em equipe"</span><span class="p">,</span>
    <span class="p">]</span>

<div class="viewcode-block" id="Mapping.to_sections"><a class="viewcode-back" href="../../../modules.ahp.html#modules.ahp.Ahp.Mapping.to_sections">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">to_sections</span><span class="p">(</span><span class="n">competences</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">]]:</span>
        <span class="sd">"""</span>
<span class="sd">        Mapping the output of graphs  - calculated in function :meth:`modules.grid.Competence.walk_through_graph` - into a mapping</span>
<span class="sd">        of matrix to list of float (ordered)</span>

<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        `competences`:</span>
<span class="sd">            A dictionary containing competences and it's results</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict[str, Union[List[float], float]]</span>
<span class="sd">            A dictionary mapping this competences to it's equivalent matrix.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Map the student's propagated value of its competence into sections equivalent.\</span>
<span class="sd">            This step is important \</span>
<span class="sd">                because it's used to normalize the competences values into this sections.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; competences = {</span>
<span class="sd">        ...     "Conhecimento técnico": 0.8,</span>
<span class="sd">        ...     "Competências, habilidades e atributos ...": 0.9,</span>
<span class="sd">        ...     "Competências e habilidades interpessoais ...": 0.3,</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; Mapping.to_sections(competences)</span>
<span class="sd">        { "q1": [0.8, 0.9, 0.3] }</span>
<span class="sd">        """</span>
        <span class="n">keys</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">competences</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># mapping root</span>
        <span class="c1"># NOTE: root can't be tracked due to its functionality</span>
        <span class="c1"># root: List[str] = []</span>
        <span class="c1"># for competence in Mapping.COMPETENCES_MATRIX_ROOT:</span>
        <span class="c1">#     if competence not in keys:</span>
        <span class="c1">#         raise Exception(f"Element {competence} not in competences")</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         root.append(competences[competence])</span>

        <span class="n">q1</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">competence</span> <span class="ow">in</span> <span class="n">Mapping</span><span class="o">.</span><span class="n">COMPETENCES_MATRIX_Q1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">competence</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Element </span><span class="si">{</span><span class="n">competence</span><span class="si">}</span><span class="s2"> not in competences"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">q1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">competences</span><span class="p">[</span><span class="n">competence</span><span class="p">])</span>

        <span class="n">q12</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">competence</span> <span class="ow">in</span> <span class="n">Mapping</span><span class="o">.</span><span class="n">COMPETENCES_MATRIX_Q12</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">competence</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Element </span><span class="si">{</span><span class="n">competence</span><span class="si">}</span><span class="s2"> not in competences"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">q12</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">competences</span><span class="p">[</span><span class="n">competence</span><span class="p">])</span>

        <span class="n">q13</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">competence</span> <span class="ow">in</span> <span class="n">Mapping</span><span class="o">.</span><span class="n">COMPETENCES_MATRIX_Q13</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">competence</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Element </span><span class="si">{</span><span class="n">competence</span><span class="si">}</span><span class="s2"> not in competences"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">q13</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">competences</span><span class="p">[</span><span class="n">competence</span><span class="p">])</span>

        <span class="n">q15</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">competence</span> <span class="ow">in</span> <span class="n">Mapping</span><span class="o">.</span><span class="n">COMPETENCES_MATRIX_Q15</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">competence</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Element </span><span class="si">{</span><span class="n">competence</span><span class="si">}</span><span class="s2"> not in competences"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">q15</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">competences</span><span class="p">[</span><span class="n">competence</span><span class="p">])</span>

        <span class="n">q2</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">competence</span> <span class="ow">in</span> <span class="n">Mapping</span><span class="o">.</span><span class="n">COMPETENCES_MATRIX_Q2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">competence</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Element </span><span class="si">{</span><span class="n">competence</span><span class="si">}</span><span class="s2"> not in competences"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">q2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">competences</span><span class="p">[</span><span class="n">competence</span><span class="p">])</span>

        <span class="n">q3</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">competence</span> <span class="ow">in</span> <span class="n">Mapping</span><span class="o">.</span><span class="n">COMPETENCES_MATRIX_Q3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">competence</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Element </span><span class="si">{</span><span class="n">competence</span><span class="si">}</span><span class="s2"> not in competences"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">q3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">competences</span><span class="p">[</span><span class="n">competence</span><span class="p">])</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">'q1'</span><span class="p">,</span> <span class="s1">'q12'</span><span class="p">,</span> <span class="s1">'q13'</span><span class="p">,</span> <span class="s1">'q15'</span><span class="p">,</span> <span class="s1">'q2'</span><span class="p">,</span> <span class="s1">'q3'</span><span class="p">],</span>
            <span class="p">[</span><span class="n">q1</span><span class="p">,</span> <span class="n">q12</span><span class="p">,</span> <span class="n">q13</span><span class="p">,</span> <span class="n">q15</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">]))</span></div>

<div class="viewcode-block" id="Mapping.to_matrices"><a class="viewcode-back" href="../../../modules.ahp.html#modules.ahp.Ahp.Mapping.to_matrices">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">to_matrices</span><span class="p">(</span><span class="n">competences</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">]]:</span>
        <span class="sd">"""</span>
<span class="sd">        It's just a bidding to :meth:`.to_sections`</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">Mapping</span><span class="o">.</span><span class="n">to_sections</span><span class="p">(</span><span class="n">competences</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mapping.remove_unused_keys"><a class="viewcode-back" href="../../../modules.ahp.html#modules.ahp.Ahp.Mapping.remove_unused_keys">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_unused_keys</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">"""</span>
<span class="sd">        This method, remove the elements in intersection between</span>
<span class="sd">        COMPETENCES_MATRIX_FORM_Q1 - COMPETENCES_MATRIX_Q1</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span></div>

<div class="viewcode-block" id="Mapping.to_competences"><a class="viewcode-back" href="../../../modules.ahp.html#modules.ahp.Ahp.Mapping.to_competences">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">to_competences</span><span class="p">(</span><span class="n">matrices</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="sd">"""</span>
<span class="sd">        Does a mapping with AHP priority vector.</span>

<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        `matrices`:</span>
<span class="sd">            A dictionary containing a list (or scalar), to every matrix. \</span>
<span class="sd">                A matrix is defined as *root*, *q1*, *q12*, *q13*, *q15*, *q2*, *q3*</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        Dict[str, float]</span>
<span class="sd">            It returns a dictionary mapping competences to an specific scalar.</span>

<span class="sd">        Tip</span>
<span class="sd">        ---</span>
<span class="sd">        Usually used with values of *priority vector*, obtained in function :meth:`calculate`</span>
<span class="sd">        """</span>
        <span class="n">competences</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># check if all matrices exists</span>
        <span class="k">for</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'q1'</span><span class="p">,</span> <span class="s1">'q12'</span><span class="p">,</span> <span class="s1">'q13'</span><span class="p">,</span> <span class="s1">'q2'</span><span class="p">,</span> <span class="s1">'q3'</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">matrix</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">matrices</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">'Matrix </span><span class="si">{</span><span class="n">matrix</span><span class="si">}</span><span class="s1"> doesn</span><span class="se">\'</span><span class="s1"> not exist in matrices dict'</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">'root'</span> <span class="ow">in</span> <span class="n">matrices</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrices</span><span class="p">[</span><span class="s1">'root'</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">'Length of root matrix aren</span><span class="se">\'</span><span class="s1">t corrent'</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">competence</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Mapping</span><span class="o">.</span><span class="n">COMPETENCES_MATRIX_ROOT</span><span class="p">):</span>
                <span class="n">competences</span><span class="p">[</span><span class="n">competence</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrices</span><span class="p">[</span><span class="s1">'root'</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>

        <span class="c1"># NOTE: that you can pass COMPETENCES_MATRIX_FORM_Q1, however</span>
        <span class="c1"># it will be mapped to COMPETENCES_MATRIX_Q1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrices</span><span class="p">[</span><span class="s1">'q1'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">matrices</span><span class="p">[</span><span class="s1">'q1'</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mapping</span><span class="o">.</span><span class="n">remove_unused_keys</span><span class="p">(</span><span class="n">matrices</span><span class="p">[</span><span class="s1">'q1'</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrices</span><span class="p">[</span><span class="s1">'q1'</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">'Length of q1 matrix aren</span><span class="se">\'</span><span class="s1">t corrent'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">competence</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Mapping</span><span class="o">.</span><span class="n">COMPETENCES_MATRIX_Q1</span><span class="p">):</span>
            <span class="n">competences</span><span class="p">[</span><span class="n">competence</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrices</span><span class="p">[</span><span class="s1">'q1'</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrices</span><span class="p">[</span><span class="s1">'q12'</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">'Length of q12 matrix aren</span><span class="se">\'</span><span class="s1">t corrent'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">competence</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Mapping</span><span class="o">.</span><span class="n">COMPETENCES_MATRIX_Q12</span><span class="p">):</span>
            <span class="n">competences</span><span class="p">[</span><span class="n">competence</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrices</span><span class="p">[</span><span class="s1">'q12'</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrices</span><span class="p">[</span><span class="s1">'q13'</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">'Length of q13 matrix aren</span><span class="se">\'</span><span class="s1">t corrent'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">competence</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Mapping</span><span class="o">.</span><span class="n">COMPETENCES_MATRIX_Q13</span><span class="p">):</span>
            <span class="n">competences</span><span class="p">[</span><span class="n">competence</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrices</span><span class="p">[</span><span class="s1">'q13'</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">matrices</span><span class="p">[</span><span class="s1">'q15'</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
            <span class="n">competences</span><span class="p">[</span><span class="n">Mapping</span><span class="o">.</span><span class="n">COMPETENCES_MATRIX_Q15</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">matrices</span><span class="p">[</span><span class="s1">'q15'</span><span class="p">]</span>
            <span class="n">competences</span><span class="p">[</span><span class="n">Mapping</span><span class="o">.</span><span class="n">COMPETENCES_MATRIX_Q15</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> \
                <span class="n">matrices</span><span class="p">[</span><span class="s1">'q15'</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">matrices</span><span class="p">[</span><span class="s1">'q15'</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">competence</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Mapping</span><span class="o">.</span><span class="n">COMPETENCES_MATRIX_Q15</span><span class="p">):</span>
                <span class="n">competences</span><span class="p">[</span><span class="n">competence</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrices</span><span class="p">[</span><span class="s1">'q15'</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrices</span><span class="p">[</span><span class="s1">'q2'</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">'Length of q2 matrix aren</span><span class="se">\'</span><span class="s1">t corrent'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">competence</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Mapping</span><span class="o">.</span><span class="n">COMPETENCES_MATRIX_Q2</span><span class="p">):</span>
            <span class="n">competences</span><span class="p">[</span><span class="n">competence</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrices</span><span class="p">[</span><span class="s1">'q2'</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrices</span><span class="p">[</span><span class="s1">'q3'</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">'Length of q3 matrix aren</span><span class="se">\'</span><span class="s1">t corrent'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">competence</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Mapping</span><span class="o">.</span><span class="n">COMPETENCES_MATRIX_Q3</span><span class="p">):</span>
            <span class="n">competences</span><span class="p">[</span><span class="n">competence</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrices</span><span class="p">[</span><span class="s1">'q3'</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">competences</span></div></div>


<span class="k">class</span> <span class="nc">TestAhpModule</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

        <span class="c1"># https://www.youtube-nocookie.com/embed/J4T70o8gjlk?start=335</span>
        <span class="c1"># https://www.youtube-nocookie.com/embed/J4T70o8gjlk?start=569</span>
        <span class="n">ahp_testing_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">'Price or Cost'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">],</span>
                <span class="s1">'Storage Space'</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">],</span>
                <span class="s1">'Camera'</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">],</span>
                <span class="s1">'Looks'</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]},</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">'Price or Cost'</span><span class="p">,</span> <span class="s1">'Storage Space'</span><span class="p">,</span> <span class="s1">'Camera'</span><span class="p">,</span> <span class="s1">'Looks'</span><span class="p">])</span>

        <span class="c1"># converting into a List[List[float]]</span>
        <span class="n">ahp_testing_data_matrix</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">ahp_testing_data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()))</span>

        <span class="n">ahp_test_ci</span><span class="p">:</span> <span class="nb">float</span>
        <span class="n">ahp_test_pv</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
        <span class="n">ahp_test_ci</span><span class="p">,</span> <span class="n">ahp_test_pv</span> <span class="o">=</span> <span class="n">calculate</span><span class="p">(</span><span class="n">ahp_testing_data_matrix</span><span class="p">)</span>

        <span class="n">expected_pv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">'Price or Cost'</span><span class="p">,</span> <span class="s1">'Storage Space'</span><span class="p">,</span> <span class="s1">'Camera'</span><span class="p">,</span> <span class="s1">'Looks'</span><span class="p">],</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">'Criteria weights'</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.6038</span><span class="p">,</span> <span class="mf">0.1365</span><span class="p">,</span> <span class="mf">0.1958</span><span class="p">,</span> <span class="mf">0.0646</span><span class="p">]}</span>
        <span class="p">)</span>
        <span class="n">expected_ci</span> <span class="o">=</span> <span class="mf">0.037311</span>
        <span class="n">expected_pv_list</span> <span class="o">=</span> <span class="n">expected_pv</span><span class="p">[</span><span class="s1">'Criteria weights'</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">expected</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expected_pv_list</span><span class="p">,</span> <span class="n">ahp_test_pv</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">expected_ci</span><span class="p">,</span> <span class="n">ahp_test_ci</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_get_q15_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">get_q15_value</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">get_q15_value</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">get_q15_value</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">9</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="c1"># run test</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
      </article>
      <footer>
        
        <div class="related-pages">
          
          
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Pedro A C Santos
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/index.js"></script>
    <script src="../../../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>